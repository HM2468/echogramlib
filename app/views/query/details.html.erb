
<br>

<div class = "container">
    <h3>Echogram</h3>
    <div class="center-block">
        <%= image_tag(@dir, options = {size: "800x600"})%> 
    </div>
    <div class = "row">
      <div class = "col-xs-6">
        <h3>Fish location</h3>
        <br>
        <div id="gmap" style='width: 100%; height:400px;'></div> 
      </div>

      <div class = "col-xs-6">
        <div id="charts" style="width:100%;height:500px;"></div>
      </div>
    </div> 
</div>


<table class="table">
    <thead class="thead-dark">
        <tr>
            <th> Image name  </th>  
            <th> Fish date </th>
            <th> Longitude </th>  
            <th> Latitude </th>
            <th> Frequency </th>       
        </tr>
    </thead>

    <tbody>
        <tr>
        <td> <%= @gram.gramname %> </td>
        <td> <%= @gram.date %> </td>
        <td> <%= @gram.long %> </td>
        <td> <%= @gram.lat %> </td>
        <td> 
            <% temp = @gram.gramname.to_s %>
            <%= temp[-7,3] + " kHz" %>  
        </td>
        </tr>
    </tbody>
</table>

<table class="table">
    <thead class="thead-dark">
        <tr>
        <th> Species code </th>  
        <th> Scientific name </th>
        <th> English name </th>  
        <th> Percentage </th>
        <th> Mean length </th>       
        </tr>
    </thead>

    <tbody>
        <% @composition.each do |item| %>
        <tr>
            <td> <%= item.scode %> </td>
            <td> <%= item.sciname %> </td>
            <td> <%= item.engname %> </td>
            <td> <%= (item.percent.to_d * 100).to_s + "%" %> </td>
            <td> <%= item.avglength %> </td>
        </tr>
        <% end %>
    </tbody>
</table>


<script>
    function initMap() {
        var map;
        var marker;
        var location = {lat: <%=raw @gram.lat %>, lng: <%=raw @gram.long %>};
        var  ref = {lat: 60, lng: 0};

        map = new google.maps.Map(
        document.getElementById('gmap'), {zoom: 4, center: ref});
        marker = new google.maps.Marker({
                                            position: location, 
                                            map: map,
                                            title: 'Echogram location' 
                                        });
    }
</script>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtoY01RdrAUUdBbBSo3mwj7z-zuqza_QA&callback=initMap">
</script>

 <script>
$(function () {
    

        Highcharts.chart('charts', {
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie',
                options3d: {
                    enabled: true,
                    alpha: 45,
                    beta: 0
                }
            },
            title: {
                text: 'Species Compositon'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            accessibility: {
                point: {
                    valueSuffix: '%'
                }
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                    }
                }
            },
            series: [{
                name: 'percentage',
                colorByPoint: true,
                data: <%= raw @data%>
            }]
        });
    });
 </script>
